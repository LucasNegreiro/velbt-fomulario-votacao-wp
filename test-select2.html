<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Select2</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>
<body>

<select id="empresa_nome" style="width: 100%;"></select>

<script>
    jQuery(document).ready(function($) {
        console.log('Documento pronto');

        var selectElement = $('#empresa_nome');
        console.log('Elemento #empresa_nome encontrado:', selectElement.length > 0);

        if ($.fn.select2) {
            console.log('Select2 está disponível');

            selectElement.select2({
                ajax: {
                    url: 'http://aciurform.local/wp-admin/admin-ajax.php',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            action: 'buscar_empresas',
                            term: params.term || '',
                            page: params.page || 1
                        };
                    },
                    processResults: function (data) {
                        return {
                            results: data.results,
                            pagination: {
                                more: data.results.length === 10
                            }
                        };
                    }
                },
                minimumInputLength: 1,
                templateResult: formatRepo,
                templateSelection: formatRepoSelection
            }).on('select2:select', function (e) {
                var data = e.params.data;
                console.log('Empresa selecionada:', data);
            });

            console.log('Select2 foi inicializado');
        } else {
            console.log('Select2 não está disponível');
        }

        function formatRepo(repo) {
            if (repo.loading) return repo.text;
            var markup = "<div class='select2-result-repository clearfix'>" +
                "<img src='" + repo.logo + "' width='30' height='30' />" +
                "<div class='select2-result-repository__title'>" + repo.label + "</div></div>";
            return markup;
        }

        function formatRepoSelection(repo) {
            return repo.label || repo.text;
        }
    });
</script>

</body>
</html>
